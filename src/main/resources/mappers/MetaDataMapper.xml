<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="visang.dataplatform.dataportal.mapper.MetaDataMapper">

    <select id="getMetaDataWithMainCategory" resultType="QueryResponseMeta">
        select distinct tmc.main_category_name,
                        tsc.sub_category_id,
                        tsc.sub_category_name
        from tb_company_info tci
        join tb_service_info tsi on tci.company_id = tsi.company_id
        left join tb_table_meta_info ttmi on tsi.service_id = ttmi.service_id
        left join tb_main_category tmc on ttmi.main_category_id = tmc.main_category_id
        left join tb_sub_category tsc on ttmi.sub_category_id = tsc.sub_category_id
        where tsi.service_name = trim(#{serviceName}) and tmc.main_category_name = trim(#{mainCategoryName})
        order by 3;
    </select>

    <select id="getMetaDataWithSubCategory" resultType="QueryResponseMeta" fetchSize="1000">
        select distinct tsc.sub_category_name,
                        ttmi.table_meta_info_id,
                        ttmi.table_id,
                        ttmi.table_name,
                        ttmi.table_comment
        from tb_company_info tci
        join tb_service_info tsi on tci.company_id = tsi.company_id
        left join tb_table_meta_info ttmi on tsi.service_id = ttmi.service_id
        left join tb_main_category tmc on ttmi.main_category_id = tmc.main_category_id
        left join tb_sub_category tsc on ttmi.sub_category_id = tsc.sub_category_id
        where tsi.service_name = trim(#{serviceName}) and tmc.main_category_name = trim(#{mainCategoryName}) and tsc.sub_category_name = trim(#{subCategoryName})
        order by 4;
    </select>

</mapper>